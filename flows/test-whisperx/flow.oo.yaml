title: "%test-whisperx-transcription-with-srt-generation%"
nodes:
  - node_id: whisperx-transcribe#1
    task: self::whisperx-transcribe
    inputs_from:
      - handle: audio_file
        value: /oomol-driver/oomol-storage/kl.mp3
      - handle: model_size
        value: medium
      - handle: language
        value:
      - handle: batch_size
        value: 16
      - handle: enable_alignment
        value: true
      - handle: enable_diarization
        value: false
      - handle: hf_token
        value: "${{OO_SECRET:HuggingFace,HuggingFace,HF_TOKEN}}"
      - handle: compute_type
        value: "float16"

  - node_id: generate-srt#1
    task: self::generate-srt
    inputs_from:
      - handle: json_file
        from_node:
          - node_id: whisperx-transcribe#1
            output_handle: output_file
      - handle: include_speaker
        value: true
      - handle: output_path
        value:
      - handle: use_spacy_segmentation
        value: true
      - handle: spacy_model
        value: "en_core_web_sm"
      - handle: max_chars_per_subtitle
        value: 20
      - handle: max_duration_per_subtitle
        value: 5.0
      - handle: chars_per_second
        value: 4.0
      - handle: subtitle_language_preset
        value: auto
      - handle: max_words_per_subtitle
        value: 0
